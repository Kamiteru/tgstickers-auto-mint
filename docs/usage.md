# Использование

## Продвинутые функции

### Параллельные платежи

Система автоматически использует ВСЕ доступные методы платежей одновременно:

```bash
# TON + Stars одновременно
PAYMENT_METHODS=TON,STARS python main.py 2/19
```

**Результат:**
- TON стратегия: 3 покупки через блокчейн
- Stars стратегия: 3 покупки через Telegram
- **Итого: 6 паков за один запуск**

### Адаптивные эндпоинты

Система автоматически:
- Находит рабочие API эндпоинты
- Переключается на резервные при сбоях
- Сохраняет статистику производительности

```bash
# Просмотр статистики эндпоинтов
cat data/endpoint_manager_state.json
```

### Интеллектуальный rate limiter

```bash
# Статистика rate limiter
sqlite3 data/rate_limiter.db "SELECT * FROM rate_limit_state ORDER BY id DESC LIMIT 1;"
```

## Мониторинг

### Уведомления

Система отправляет 9+ типов уведомлений:

- **Старт бота** - подтверждение запуска
- **Успешная покупка** - детали транзакции
- **Ошибка покупки** - причина сбоя
- **Низкий баланс** - предупреждение
- **Rate limit** - временная блокировка
- **CAPTCHA** - требует решения
- **Новая коллекция** - доступна для покупки
- **Stars сессия** - статус подключения
- **Критическая ошибка** - требует вмешательства

### Логирование

```bash
# Разные уровни логирования
LOG_LEVEL=DEBUG python main.py 2/19  # Подробные логи
LOG_LEVEL=INFO python main.py 2/19   # Стандартные логи
LOG_LEVEL=ERROR python main.py 2/19  # Только ошибки
```

## Оптимизация производительности

### Кэширование

```bash
# Настройка TTL кэша
PRICE_CACHE_TTL=30        # Цены персонажей (секунды)
COLLECTION_CHECK_INTERVAL=5  # Проверка коллекций (секунды)
```

### Stars сессии

```bash
# Информация о качестве сессии
python main.py 2/19 --session-info
```

Показывает:
- Количество покупок в сессии
- Качество сессии (0.0-1.0)
- Время до следующего кулдауна
- Статистика успешности

### Профили производительности

```bash
# Максимальная производительность
python main.py 2/19 --extreme --stars-extreme

# Безопасный режим
python main.py 2/19 --safe --stars-conservative
```

## Безопасность

### Защита от блокировок

- **User-Agent ротация** - обход IP блокировок
- **Прокси поддержка** - анонимизация трафика
- **Circuit breaker** - защита от перегрузки API
- **Backoff алгоритмы** - умные задержки

### Валидация

Система проверяет:
- Достаточность баланса
- Доступность персонажей
- Лимиты транзакций
- Безопасность операций

## Устранение неполадок

### Частые проблемы

**Rate limit 429:**
```bash
# Снизить агрессивность
python main.py 2/19 --safe
```

**Stars сессия недоступна:**
```bash
# Переподключение
python main.py 2/19 --logout-session
python main.py 2/19 --session-info
```

**CAPTCHA ошибки:**
```bash
# Проверить API ключ
CAPTCHA_ENABLED=true python main.py 2/19 --test
```

**Низкая производительность:**
```bash
# Включить кэширование
python main.py 2/19 --test  # Preload cache
```

### Диагностика

```bash
# Полная диагностика системы
python main.py 2/19 --test

# Тест конкретных компонентов
python run_tests.py -v
```

## Интеграция

### CI/CD

```bash
# Автоматическое тестирование
python run_tests.py

# Проверка конфигурации
python main.py 2/19 --test --dry-run
```

### Мониторинг в продакшене

```bash
# Логи в JSON формате
LOG_FORMAT=json python main.py 2/19

# Метрики Prometheus (если настроено)
curl http://localhost:8000/metrics
```

## Следующий шаг

Изучите [архитектуру](architecture.md) системы для понимания внутренней работы. 